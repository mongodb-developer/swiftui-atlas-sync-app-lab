import useBaseUrl from '@docusaurus/useBaseUrl';

# Flexible configuration

## Configuring Flexible Configuration

We'll add code to configure our connection from Mobile to MongoDB Atlas in a way that only data for this user is requested. This way we avoid downloading data from other users and the connection is much more efficient.

To do that, once we have a `user` logged in, we add a `flexibleSyncConfiguration` to that user. This contains a list of subscriptions (called `subs` here). Each subscription is a query and can be much more complex than showcased here. For instance, we can be interested in data for this user, but just the last three months, not all data.

Each subscription has an identifier, and here we'll only have one, called `user_days`. We're using the queryable field `ownerId` that we added to our subscriptions in [App Services > Flexible Configuration > Configure Queryable Fields](/docs/app-services/device-sync)


```swift title="SyncContentView.swift"
// ...
if let user = app.currentUser {
        // Create a `flexibleSyncConfiguration` with `initialSubscriptions`.
        // We'll inject this configuration as an environment value to use when opening the realm
        // in the next view, and the realm will open with these initial subscriptions.
        let config = user.flexibleSyncConfiguration(initialSubscriptions: { subs in
        // Check whether the subscription already exists. Adding it more
        // than once causes an error.
        if let foundSubscriptions = subs.first(named: "user_days") {
                // Existing subscription found - do nothing
                return
        } else {
                // Add queries for any objects you want to use in the app
                // Linked objects do not automatically get queried, so you
                // must explicitly query for all linked objects you want to include
                subs.append(QuerySubscription<Places>(name: "user_days", query: {
                // Query for objects where the ownerId is equal to the app's current user's id
                // This means the app's current user can read and write their own data
                        $0.ownerId == user.id
                }))
                subs.append(QuerySubscription<Place>())
        }
        })
} else {
        // ...
}
```

## Log

If you look at the logs you'll see messages like

```
2023-07-05 17:59:39.708589+0200 GoodHabitsRealmApp[71190:9845203] Sync: Connection[1]: Session[1]: client_reset_config = false, Realm exists = true, client reset = false
2023-07-05 17:59:39.928362+0200 GoodHabitsRealmApp[71190:9845203] Sync: Connected to endpoint 'redacted-ip:443' (from 'my-ip:60529')
2023-07-05 17:59:41.038822+0200 GoodHabitsRealmApp[71190:9845203] Sync: Connection[1]: Connected to app services with request id: "64ah936ca2df64d089058fe9"
2023-07-05 17:59:41.648668+0200 GoodHabitsRealmApp[71190:9845203] Sync: Connection[1]: Session[1]: Begin processing pending FLX bootstrap for query version 0. (changesets: 1, original total changeset size: 0)
```
