"use strict";(self.webpackChunkswiftui_realm_app=self.webpackChunkswiftui_realm_app||[]).push([[657],{4137:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>g});var i=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,i,o=function(e,n){if(null==e)return{};var t,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=i.createContext({}),c=function(e){var n=i.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},u=function(e){var n=c(e.components);return i.createElement(l.Provider,{value:n},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},f=i.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(t),f=o,g=p["".concat(l,".").concat(f)]||p[f]||d[f]||r;return t?i.createElement(g,a(a({ref:n},u),{},{components:t})):i.createElement(g,a({ref:n},u))}));function g(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,a=new Array(r);a[0]=f;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[p]="string"==typeof e?e:o,a[1]=s;for(var c=2;c<r;c++)a[c]=t[c];return i.createElement.apply(null,a)}return i.createElement.apply(null,t)}f.displayName="MDXCreateElement"},5110:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var i=t(7462),o=(t(7294),t(4137));t(9524);const r={},a="Flexible configuration",s={unversionedId:"ios-app-changes/flexible-configuration",id:"ios-app-changes/flexible-configuration",title:"Flexible configuration",description:"Configuring Flexible Configuration",source:"@site/docs/3--ios-app-changes/4-flexible-configuration.mdx",sourceDirName:"3--ios-app-changes",slug:"/ios-app-changes/flexible-configuration",permalink:"/swiftui-atlas-sync-app-workshop/docs/ios-app-changes/flexible-configuration",draft:!1,editUrl:"https://github.com/mongodb-developer/swiftui-atlas-sync-app-workshop/blob/main/docs/3--ios-app-changes/4-flexible-configuration.mdx",tags:[],version:"current",sidebarPosition:4,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Running the App",permalink:"/swiftui-atlas-sync-app-workshop/docs/ios-app-changes/running-app"},next:{title:"Adding the Flexible Sync Configuration",permalink:"/swiftui-atlas-sync-app-workshop/docs/ios-app-changes/adding-config-realm"}},l={},c=[{value:"Configuring Flexible Configuration",id:"configuring-flexible-configuration",level:2},{value:"Log",id:"log",level:2}],u={toc:c},p="wrapper";function d(e){let{components:n,...t}=e;return(0,o.kt)(p,(0,i.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"flexible-configuration"},"Flexible configuration"),(0,o.kt)("h2",{id:"configuring-flexible-configuration"},"Configuring Flexible Configuration"),(0,o.kt)("p",null,"We'll add code to configure our connection from Mobile to MongoDB Atlas in a way that only data for this user is requested. This way we avoid downloading data from other users and the connection is much more efficient."),(0,o.kt)("p",null,"To do that, once we have a ",(0,o.kt)("inlineCode",{parentName:"p"},"user")," logged in, we add a ",(0,o.kt)("inlineCode",{parentName:"p"},"flexibleSyncConfiguration")," to that user. This contains a list of subscriptions (called ",(0,o.kt)("inlineCode",{parentName:"p"},"subs")," here). Each subscription is a query and can be much more complex than showcased here. For instance, we can be interested in data for this user, but just the last three months, not all data."),(0,o.kt)("p",null,"Each subscription has an identifier, and here we'll only have one, called ",(0,o.kt)("inlineCode",{parentName:"p"},"user_days"),". We're using the queryable field ",(0,o.kt)("inlineCode",{parentName:"p"},"ownerId")," that we added to our subscriptions in ",(0,o.kt)("a",{parentName:"p",href:"/docs/app-services/device-sync"},"App Services > Flexible Configuration > Configure Queryable Fields")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-swift",metastring:'title="SyncContentView.swift"',title:'"SyncContentView.swift"'},"// ...\nif let user = app.currentUser {\n        // Create a `flexibleSyncConfiguration` with `initialSubscriptions`.\n        // We'll inject this configuration as an environment value to use when opening the realm\n        // in the next view, and the realm will open with these initial subscriptions.\n        let config = user.flexibleSyncConfiguration(initialSubscriptions: { subs in\n        // Check whether the subscription already exists. Adding it more\n        // than once causes an error.\n        if let foundSubscriptions = subs.first(named: \"user_days\") {\n                // Existing subscription found - do nothing\n                return\n        } else {\n                // Add queries for any objects you want to use in the app\n                // Linked objects do not automatically get queried, so you\n                // must explicitly query for all linked objects you want to include\n                subs.append(QuerySubscription<Places>(name: \"user_days\", query: {\n                // Query for objects where the ownerId is equal to the app's current user's id\n                // This means the app's current user can read and write their own data\n                        $0.ownerId == user.id\n                }))\n                subs.append(QuerySubscription<Place>())\n        }\n        })\n} else {\n        // ...\n}\n")),(0,o.kt)("h2",{id:"log"},"Log"),(0,o.kt)("p",null,"If you look at the logs you'll see messages like"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"2023-07-05 17:59:39.708589+0200 GoodHabitsRealmApp[71190:9845203] Sync: Connection[1]: Session[1]: client_reset_config = false, Realm exists = true, client reset = false\n2023-07-05 17:59:39.928362+0200 GoodHabitsRealmApp[71190:9845203] Sync: Connected to endpoint 'redacted-ip:443' (from 'my-ip:60529')\n2023-07-05 17:59:41.038822+0200 GoodHabitsRealmApp[71190:9845203] Sync: Connection[1]: Connected to app services with request id: \"64ah936ca2df64d089058fe9\"\n2023-07-05 17:59:41.648668+0200 GoodHabitsRealmApp[71190:9845203] Sync: Connection[1]: Session[1]: Begin processing pending FLX bootstrap for query version 0. (changesets: 1, original total changeset size: 0)\n")))}d.isMDXComponent=!0}}]);